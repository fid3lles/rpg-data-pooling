<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Dashboard RPG</title>
    <link rel="stylesheet" href="public/css/style.css">
</head>
<body>
    <div id="agent-wrapper">
        <div class="agent-card" id="felipe-consolas">
            <div class="agent-image">
                <img id="agent-photo" src="https://cdn.discordapp.com/attachments/322789973528936468/1073810887112130630/IMG_4775.PNG">
            </div>
            <div class="agent-info">
                <p>
                    Pontos de vida: <span id="life-points">0 / 0</span>
                </p>
                <p>
                    Pontos de sanidade: <span id="sanity-points">0 / 0</span>
                </p>
                <p>
                    Pontos de esforço: <span id="effort-points">0 / 0</span>
                </p>
            </div>
        </div>
        <div class="agent-card"  id="angelina-gomes">
            <div class="agent-image">
                <img id="agent-photo" src="https://cdn.discordapp.com/attachments/322789973528936468/1073810887447683172/IMG_4699.PNG">
            </div>
            <div class="agent-info">
                <p>
                    Pontos de vida: <span id="life-points">0 / 0</span>
                </p>
                <p>
                    Pontos de sanidade: <span id="sanity-points">0 / 0</span>
                </p>
                <p>
                    Pontos de esforço: <span id="effort-points">0 / 0</span>
                </p>
            </div>
        </div>
        <div class="agent-card" id="fred-biggins">
            <div class="agent-image">
                <img id="agent-photo" src="https://cdn.discordapp.com/attachments/322789973528936468/1073810886780792912/IMG_4692.PNG">
            </div>
            <div class="agent-info">
                <p>
                    Pontos de vida: <span id="life-points">0 / 0</span>
                </p>
                <p>
                    Pontos de sanidade: <span id="sanity-points">0 / 0</span>
                </p>
                <p>
                    Pontos de esforço: <span id="effort-points">0 / 0</span>
                </p>
            </div>
        </div>
        <div class="agent-card" id="raul-cervero">
            <div class="agent-image">
                <img id="agent-photo" src="https://cdn.discordapp.com/attachments/322789973528936468/1073810887745470504/IMG_4773.PNG">
            </div>
            <div class="agent-info">
                <p>
                    Pontos de vida: <span id="life-points">0 / 0</span>
                </p>
                <p>
                    Pontos de sanidade: <span id="sanity-points">0 / 0</span>
                </p>
                <p>
                    Pontos de esforço: <span id="effort-points">0 / 0</span>
                </p>
            </div>
        </div>
    </div>
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

    //Server configurations
    const ip = 'localhost';
    const port = 3000;
    const apiBaseHref = `http://${ip}:${port}`;
    const agentsWrapper = document.getElementsByClassName("agent-card");

    //Data consulting
    function refreshData(){
        console.log('refreshing data');
        $.get(`${apiBaseHref}/userinfo`, function (data) {
            data.forEach(agent => {
                for(e of agentsWrapper){
                    if(e.id == agent.id){
                        e.getElementsByTagName('span')[0].textContent = agent.hp;
                        e.getElementsByTagName('span')[1].textContent = agent.san;
                        e.getElementsByTagName('span')[2].textContent = agent.ep;
                    }
                }
            });
        });
    } 

    setInterval(() => { refreshData()}, 2000);
</script>
</html>